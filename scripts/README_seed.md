# ملف Seed للمنتجات والمزادات

## نظرة عامة
هذا الملف يحتوي على بيانات تجريبية شاملة لمنصة لوفت الدغيري للحمام الزاجل، ويشمل:
- منتجات الحمام الزاجل (ذكور، إناث، صغار)
- مستلزمات الحمام (علف، فيتامينات، أقفاص، أدوات نظافة)
- مزادات نشطة ومجدولة
- مزايدات تجريبية
- وسائط (صور) للمنتجات

## المحتويات

### 1. المدن (10 مدن)
- الرياض، جدة، الدمام، مكة، المدينة
- تبوك، أبها، حائل، القصيم، الجوف
- مع رسوم شحن مختلفة لكل مدينة

### 2. المستخدمين (10 مستخدمين)
- أحمد الدغيري (مدير)
- 9 مستخدمين موثقين من مدن مختلفة
- جميعهم لديهم حسابات موثقة ومفعلة

### 3. المنتجات - الحمام الزاجل (15 منتج)
- **5 حمام ذكور**: سلالات مختلفة (الدغيري، العتيبي، الشمري، القحطاني، الحربي)
- **5 حمام إناث**: نفس السلالات، مناسبة للتربية
- **5 حمام صغار**: مناسب للمبتدئين، أعمار 6-8 أشهر

### 4. المنتجات - المستلزمات (25 منتج)
- **5 أنواع علف**: فاخر، عادي، صغار، تربية، مسابقات
- **5 مكملات**: فيتامينات، بروتين، طاقة، مناعة، هضم
- **5 أقفاص**: أحجام مختلفة (صغير، متوسط، كبير، تربية، مسابقات)
- **5 منتجات نظافة**: مطهرات، منظفات، معطرات
- **5 أدوات تدريب**: أساور هوية، موازين، ساعات توقيت

### 5. المزادات (5 مزادات)
- **مزاد نشط واحد**: حمام ذكر سلالة الدغيري
- **4 مزادات مجدولة**: تبدأ في أوقات مختلفة
- جميعها لحمام زاجل (لا توجد مزادات للمستلزمات)

### 6. المزايدات (9 مزايدات)
- مزايدات متعددة على المزاد النشط
- أسعار متدرجة من 850 إلى 1250 ريال
- مشاركة من جميع المستخدمين الموثقين

### 7. الوسائط (10 صور)
- صور متعددة للمنتجات الرئيسية
- صور الحمام مع علامات مائية
- صور المستلزمات بدون علامات مائية

## كيفية الاستخدام

### 1. تشغيل الملف
```bash
# من مجلد المشروع
psql -h localhost -U username -d database_name -f scripts/seed_products_auctions.sql
```

### 2. تشغيل من خلال Encore
```bash
# من مجلد المشروع
encore db shell coredb
# ثم نسخ ولصق محتوى الملف
```

### 3. تشغيل من خلال Docker
```bash
docker exec -i container_name psql -U username -d database_name < scripts/seed_products_auctions.sql
```

## ملاحظات مهمة

### الأمان
- كلمات المرور في الملف هي `$2a$10$hashed_password_X` (مشفرة)
- في الإنتاج، استبدل هذه القيم بكلمات مرور حقيقية

### التواريخ
- المزادات المجدولة تبدأ من اليوم + 1-5 أيام
- المزاد النشط بدأ منذ ساعة واحدة
- جميع التواريخ تستخدم `NOW()` + `INTERVAL`

### البيانات
- جميع البيانات تستخدم `ON CONFLICT DO NOTHING`
- يمكن تشغيل الملف عدة مرات بدون أخطاء
- البيانات تتضمن جميع العلاقات المطلوبة

## استكشاف البيانات

### عرض المنتجات
```sql
-- جميع منتجات الحمام
SELECT * FROM products WHERE type = 'pigeon';

-- جميع المستلزمات
SELECT * FROM products WHERE type = 'supply';

-- المنتجات في المزادات
SELECT * FROM products WHERE status = 'in_auction';
```

### عرض المزادات
```sql
-- المزادات النشطة
SELECT * FROM auctions WHERE status = 'live';

-- المزادات المجدولة
SELECT * FROM auctions WHERE status = 'scheduled';

-- المزادات مع تفاصيل المنتجات
SELECT a.*, p.title, p.price_net 
FROM auctions a 
JOIN products p ON a.product_id = p.id;
```

### عرض المزايدات
```sql
-- مزايدات مزاد معين
SELECT b.*, u.name, c.name_ar as city_name
FROM bids b
JOIN users u ON b.user_id = u.id
JOIN cities c ON b.bidder_city_id_snapshot = c.id
WHERE b.auction_id = 1
ORDER BY b.amount DESC;
```

## استكشاف الأخطاء

### مشاكل شائعة
1. **خطأ في العلاقات**: تأكد من وجود جداول `users` و `cities` أولاً
2. **خطأ في الأنواع**: تأكد من تشغيل ملفات الهجرة بالترتيب الصحيح
3. **خطأ في الصلاحيات**: تأكد من صلاحيات المستخدم في قاعدة البيانات

### حل المشاكل
```sql
-- التحقق من وجود الجداول
\dt

-- التحقق من وجود المستخدمين
SELECT COUNT(*) FROM users;

-- التحقق من وجود المدن
SELECT COUNT(*) FROM cities;

-- التحقق من المنتجات
SELECT COUNT(*) FROM products;
```

## تحديث البيانات

### إضافة منتجات جديدة
```sql
INSERT INTO products (type, title, slug, description, price_net, status) VALUES
('pigeon', 'عنوان جديد', 'slug-جديد', 'وصف جديد', 500.00, 'available');
```

### إضافة مزاد جديد
```sql
INSERT INTO auctions (product_id, start_price, bid_step, reserve_price, start_at, end_at, anti_sniping_minutes, status) VALUES
(1, 600.00, 25, 800.00, NOW() + INTERVAL '1 day', NOW() + INTERVAL '7 days', 15, 'scheduled');
```

## دعم التطوير

هذا الملف مصمم لبيئة التطوير والاختبار. في الإنتاج:
- استبدل كلمات المرور بقيم حقيقية
- أضف المزيد من التحقق من صحة البيانات
- فكر في استخدام أدوات إدارة البيانات مثل Flyway أو Liquibase

## المساعدة

للمساعدة أو الاستفسارات:
- راجع ملفات الهجرة في مجلد `coredb/migrations/`
- تحقق من وثائق المشروع
- راجع ملف `PRD` للمتطلبات التفصيلية
